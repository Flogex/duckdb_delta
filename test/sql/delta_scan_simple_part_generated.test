# name: test/sql/delta_scan_simple_part_generated.test
# description: test deltatable extension
# group: [deltatable]

require parquet

require deltatable

require-env GENERATED_DATA_AVAILABLE

# With a projection and delta constant column
query III
SELECT delta_file_number, part, i
FROM delta_scan('file:///Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake', delta_file_number=1);
----
0	0	0
0	0	2
0	0	4
0	0	6
0	0	8
1	1	1
1	1	3
1	1	5
1	1	7
1	1	9

mode skip

# Simplest case
query II
FROM delta_scan('file:///Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake');
----
0	0
2	0
4	0
6	0
8	0
1	1
3	1
5	1
7	1
9	1

# With a projection
query II
SELECT part, i
FROM delta_scan('file:///Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake');
----
0	0
0	2
0	4
0	6
0	8
1	1
1	3
1	5
1	7
1	9

# With a projection and delta constant column
query III
SELECT delta_file_number, part, i
FROM delta_scan('file:///Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake', delta_file_number=1);
----
0	0	0
0	0	2
0	0	4
0	0	6
0	0	8
1	1	1
1	1	3
1	1	5
1	1	7
1	1	9

# different permutation
query III
SELECT part, delta_file_number, i
FROM delta_scan('file:///Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake', delta_file_number=1);
----
0	0	0
0	0	2
0	0	4
0	0	6
0	0	8
1	1	1
1	1	3
1	1	5
1	1	7
1	1	9

# different permutation again
query III
SELECT part, i, delta_file_number
FROM delta_scan('file:///Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake', delta_file_number=1);
----
0	0	0
0	2	0
0	4	0
0	6	0
0	8	0
1	1	1
1	3	1
1	5	1
1	7	1
1	9	1

# With a projection and both a base multifilereader column and the file_row_number option
query IIII
SELECT filename, part, i, file_row_number
FROM delta_scan('file:///Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake', file_row_number=1, filename=1);
----
/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=0/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	0	0	0
/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=0/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	0	2	1
/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=0/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	0	4	2
/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=0/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	0	6	3
/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=0/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	0	8	4
/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=1/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	1	1	0
/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=1/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	1	3	1
/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=1/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	1	5	2
/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=1/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	1	7	3
/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=1/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	1	9	4

# Final boss: add the delta_file_number to the mix
query IIIII
SELECT delta_file_number, filename, part, i, file_row_number
FROM delta_scan('file:///Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake', file_row_number=1, filename=1, delta_file_number=1);
----
0	/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=0/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	0	0	0
0	/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=0/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	0	2	1
0	/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=0/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	0	4	2
0	/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=0/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	0	6	3
0	/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=0/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	0	8	4
1	/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=1/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	1	1	0
1	/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=1/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	1	3	1
1	/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=1/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	1	5	2
1	/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=1/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	1	7	3
1	/Users/sam/Development/delta-kernel-testing/data/generated/simple_partitioned/delta_lake/part=1/0-acbdd600-ea69-4180-81c7-530d09bcfcfe-0.parquet	1	9	4
