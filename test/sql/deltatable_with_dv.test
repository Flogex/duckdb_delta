# name: test/sql/deltatable_with_dv.test
# description: test deltatable extension with deletion vector
# group: [deltatable]

require parquet

require deltatable

# Simplest example
query I
FROM delta_scan('file:///Users/sam/Development/delta-kernel-testing/delta-kernel-rs/kernel/tests/data/table-with-dv-small/')
----
1
2
3
4
5
6
7
8

# With filter: ensures the deletion vector is applied properly on top of pushed down filters
query I
FROM delta_scan('file:///Users/sam/Development/delta-kernel-testing/delta-kernel-rs/kernel/tests/data/table-with-dv-small/')
WHERE value > 3
----
4
5
6
7
8

# TODO: test with laaarge data with dv's
# TODO: test with delta_file_number option
# TODO: test with file_row_number option: ensure we don't enable the extra DataChunk reference step in the parquet scanner